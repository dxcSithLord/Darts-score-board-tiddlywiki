<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Darts Competition Scoreboard</title>
<style>
/* TiddlyWiki-inspired styling */
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 20px;
    color: #333;
}

.tiddlywiki-header {
    background: #5778d8;
    color: white;
    padding: 15px 20px;
    margin: -20px -20px 20px -20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.tiddler {
    background: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-bottom: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.tiddler-title {
    background: #f8f8f8;
    border-bottom: 1px solid #ddd;
    padding: 10px 15px;
    font-weight: bold;
    color: #5778d8;
}

.tiddler-content {
    padding: 15px;
}

.scoreboard {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

.scoreboard th, .scoreboard td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
}

.scoreboard th {
    background: #5778d8;
    color: white;
    font-weight: bold;
}

.scoreboard tr:nth-child(even) {
    background: #f9f9f9;
}

.scoreboard tr:hover {
    background: #e8f0fe;
}

.player-controls {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 10px;
    padding: 10px;
    background: #f0f0f0;
    border-radius: 4px;
}

.player-controls input {
    padding: 5px 10px;
    border: 1px solid #ccc;
    border-radius: 3px;
}

.btn {
    background: #5778d8;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 3px;
    cursor: pointer;
    font-size: 14px;
}

.btn:hover {
    background: #4a67c4;
}

.btn-small {
    padding: 5px 10px;
    font-size: 12px;
}

.btn-danger {
    background: #dc3545;
}

.btn-danger:hover {
    background: #c82333;
}

.score-input {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 15px;
    padding: 10px;
    background: #e8f0fe;
    border-radius: 4px;
}

.game-controls {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.current-game {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 20px;
}

.winner {
    background: #d4edda !important;
    color: #155724;
    font-weight: bold;
}

.match-history {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #ddd;
    padding: 10px;
    background: #f9f9f9;
    border-radius: 4px;
}
</style>
</head>
<body>

<div class="tiddlywiki-header">
    <h1>ðŸŽ¯ Darts Competition Scoreboard</h1>
    <p>Professional darts tournament management system</p>
</div>

<div class="tiddler">
    <div class="tiddler-title">Tournament Setup</div>
    <div class="tiddler-content">
        <div class="player-controls">
            <input type="text" id="playerName" placeholder="Enter player name" maxlength="20">
            <button class="btn" onclick="addPlayer()">Add Player</button>
            <select id="gameType">
                <option value="501">501 Game</option>
                <option value="301">301 Game</option>
                <option value="cricket">Cricket</option>
            </select>
            <button class="btn" onclick="startNewGame()">Start New Game</button>
            <button class="btn btn-danger" onclick="resetTournament()">Reset Tournament</button>
        </div>
    </div>
</div>

<div class="tiddler" id="currentGameTiddler" style="display:none;">
    <div class="tiddler-title">Current Game</div>
    <div class="tiddler-content">
        <div class="current-game" id="gameInfo">
            <strong>Game Type:</strong> <span id="currentGameType">501</span> | 
            <strong>Current Player:</strong> <span id="currentPlayer">-</span>
        </div>
        
        <div class="score-input">
            <label>Score Thrown:</label>
            <input type="number" id="scoreInput" placeholder="0-180" min="0" max="180">
            <button class="btn" onclick="recordScore()">Record Score</button>
            <button class="btn btn-small" onclick="undoLastScore()">Undo</button>
        </div>
    </div>
</div>

<div class="tiddler">
    <div class="tiddler-title">Live Scoreboard</div>
    <div class="tiddler-content">
        <table class="scoreboard" id="scoreboard">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Current Score</th>
                    <th>Games Won</th>
                    <th>Average</th>
                    <th>Best Finish</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="scoreboardBody">
                <tr>
                    <td colspan="6">Add players to start the tournament</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="tiddler">
    <div class="tiddler-title">Match History</div>
    <div class="tiddler-content">
        <div class="match-history" id="matchHistory">
            <p>Match history will appear here...</p>
        </div>
    </div>
</div>

<script>
// Tournament data
let players = [];
let currentGame = null;
let currentPlayerIndex = 0;
let gameHistory = [];
let scoreHistory = [];

// Player constructor
function Player(name) {
    this.name = name;
    this.currentScore = 501;
    this.gamesWon = 0;
    this.totalThrows = 0;
    this.totalScore = 0;
    this.bestFinish = 0;
    this.active = true;
}

// Add player function
function addPlayer() {
    const nameInput = document.getElementById('playerName');
    const name = nameInput.value.trim();
    
    if (!name) {
        alert('Please enter a player name');
        return;
    }
    
    if (players.find(p => p.name === name)) {
        alert('Player already exists');
        return;
    }
    
    players.push(new Player(name));
    nameInput.value = '';
    updateScoreboard();
    addToHistory(`Player ${name} joined the tournament`);
}

// Start new game
function startNewGame() {
    if (players.length < 2) {
        alert('Need at least 2 players to start a game');
        return;
    }
    
    const gameType = document.getElementById('gameType').value;
    const startScore = gameType === '301' ? 301 : 501;
    
    // Reset all players for new game
    players.forEach(player => {
        player.currentScore = gameType === 'cricket' ? 0 : startScore;
        player.active = true;
    });
    
    currentGame = {
        type: gameType,
        startScore: startScore,
        inProgress: true
    };
    
    currentPlayerIndex = 0;
    scoreHistory = [];
    
    document.getElementById('currentGameTiddler').style.display = 'block';
    document.getElementById('currentGameType').textContent = gameType;
    updateCurrentPlayer();
    updateScoreboard();
    
    addToHistory(`New ${gameType} game started with ${players.length} players`);
}

// Record score
function recordScore() {
    if (!currentGame || !currentGame.inProgress) {
        alert('No game in progress');
        return;
    }
    
    const scoreInput = document.getElementById('scoreInput');
    const score = parseInt(scoreInput.value) || 0;
    
    if (score < 0 || score > 180) {
        alert('Score must be between 0 and 180');
        return;
    }
    
    const currentPlayer = players[currentPlayerIndex];
    
    // Record the throw for undo functionality
    scoreHistory.push({
        playerIndex: currentPlayerIndex,
        oldScore: currentPlayer.currentScore,
        thrownScore: score
    });
    
    // Update player stats
    currentPlayer.totalThrows++;
    currentPlayer.totalScore += score;
    
    if (currentGame.type === 'cricket') {
        currentPlayer.currentScore += score;
    } else {
        currentPlayer.currentScore -= score;
        
        // Check for bust (score below 0 or exactly 1)
        if (currentPlayer.currentScore < 0 || currentPlayer.currentScore === 1) {
            currentPlayer.currentScore += score; // Reset score
            addToHistory(`${currentPlayer.name} bust! Score reset.`);
        }
        
        // Check for win
        if (currentPlayer.currentScore === 0) {
            currentPlayer.gamesWon++;
            currentPlayer.active = false;
            currentGame.inProgress = false;
            
            if (score > currentPlayer.bestFinish) {
                currentPlayer.bestFinish = score;
            }
            
            addToHistory(`ðŸŽ‰ ${currentPlayer.name} wins the game with a ${score} finish!`);
            document.getElementById('currentGameTiddler').style.display = 'none';
            updateScoreboard();
            scoreInput.value = '';
            return;
        }
    }
    
    // Move to next player
    do {
        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    } while (!players[currentPlayerIndex].active);
    
    updateCurrentPlayer();
    updateScoreboard();
    scoreInput.value = '';
    
    addToHistory(`${currentPlayer.name} threw ${score}, score now ${currentPlayer.currentScore}`);
}

// Undo last score
function undoLastScore() {
    if (scoreHistory.length === 0) {
        alert('No scores to undo');
        return;
    }
    
    const lastScore = scoreHistory.pop();
    const player = players[lastScore.playerIndex];
    
    player.currentScore = lastScore.oldScore;
    player.totalThrows--;
    player.totalScore -= lastScore.thrownScore;
    
    // Move back to previous player
    currentPlayerIndex = lastScore.playerIndex;
    currentGame.inProgress = true;
    
    updateCurrentPlayer();
    updateScoreboard();
    document.getElementById('currentGameTiddler').style.display = 'block';
    
    addToHistory(`Undid ${player.name}'s throw of ${lastScore.thrownScore}`);
}

// Update current player display
function updateCurrentPlayer() {
    if (currentGame && currentGame.inProgress) {
        document.getElementById('currentPlayer').textContent = players[currentPlayerIndex].name;
    }
}

// Remove player
function removePlayer(index) {
    const player = players[index];
    players.splice(index, 1);
    
    if (currentPlayerIndex >= players.length) {
        currentPlayerIndex = 0;
    }
    
    updateScoreboard();
    updateCurrentPlayer();
    addToHistory(`Player ${player.name} removed from tournament`);
}

// Update scoreboard
function updateScoreboard() {
    const tbody = document.getElementById('scoreboardBody');
    
    if (players.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">Add players to start the tournament</td></tr>';
        return;
    }
    
    tbody.innerHTML = '';
    
    players.forEach((player, index) => {
        const row = tbody.insertRow();
        
        if (!player.active && currentGame && currentGame.inProgress) {
            row.classList.add('winner');
        }
        
        const average = player.totalThrows > 0 ? (player.totalScore / player.totalThrows).toFixed(1) : '0.0';
        
        row.innerHTML = `
            <td><strong>${player.name}</strong></td>
            <td>${player.currentScore}</td>
            <td>${player.gamesWon}</td>
            <td>${average}</td>
            <td>${player.bestFinish || '-'}</td>
            <td>
                <button class="btn btn-small btn-danger" onclick="removePlayer(${index})">Remove</button>
            </td>
        `;
    });
}

// Add to match history
function addToHistory(message) {
    const timestamp = new Date().toLocaleTimeString();
    gameHistory.unshift(`[${timestamp}] ${message}`);
    
    // Keep only last 50 entries
    if (gameHistory.length > 50) {
        gameHistory = gameHistory.slice(0, 50);
    }
    
    const historyDiv = document.getElementById('matchHistory');
    historyDiv.innerHTML = gameHistory.map(entry => `<p>${entry}</p>`).join('');
}

// Reset tournament
function resetTournament() {
    if (confirm('Are you sure you want to reset the entire tournament?')) {
        players = [];
        currentGame = null;
        currentPlayerIndex = 0;
        gameHistory = [];
        scoreHistory = [];
        
        document.getElementById('currentGameTiddler').style.display = 'none';
        updateScoreboard();
        
        document.getElementById('matchHistory').innerHTML = '<p>Match history will appear here...</p>';
        addToHistory('Tournament reset');
    }
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
        const scoreInput = document.getElementById('scoreInput');
        if (document.activeElement === scoreInput) {
            recordScore();
        }
    }
});

// Initialize
addToHistory('Darts Competition Scoreboard initialized');
</script>

</body>
</html>
